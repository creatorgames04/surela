<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Avis Clients - SureLA</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css">
  <style>
    .avis-card { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <div class="container my-5">
    <h1>Avis Clients</h1>
    <div id="avis-list" class="mb-4"></div>
    <h2>Laisser un avis</h2>
    <form id="avisForm" class="mb-5">
      <div class="mb-3">
        <label for="avis-nom" class="form-label">Nom</label>
        <input type="text" id="avis-nom" name="nom" class="form-control" placeholder="Votre nom" required>
      </div>
      <div class="mb-3">
        <label for="avis-message" class="form-label">Votre avis</label>
        <textarea id="avis-message" name="message" class="form-control" placeholder="Votre avis" required></textarea>
      </div>
      <button type="submit" class="btn btn-primary">Envoyer</button>
    </form>
    <div id="confirmation" class="mt-3 text-success"></div>
    <a href="index.html" class="btn btn-outline-secondary">Retour Ã  l'accueil</a>
  </div>
  <script>
    // Affichage des avis en localStorage
    function afficherAvis() {
      const avisList = document.getElementById('avis-list');
      const avis = JSON.parse(localStorage.getItem('surela_avis') || '[]');
      avisList.innerHTML = avis.map(a =>
        `<div class="card avis-card">
          <div class="card-body">
            <h5 class="card-title">${a.nom}</h5>
            <p class="card-text">${a.message}</p>
          </div>
        </div>`
      ).join('');
    }
    document.getElementById('avisForm').onsubmit = async function(e) {
      e.preventDefault();
      const nom = document.getElementById('avis-nom').value.trim();
      const message = document.getElementById('avis-message').value.trim();
      if(nom && message) {
        // Ajoute dans localStorage (pour affichage local)
        const avis = JSON.parse(localStorage.getItem('surela_avis') || '[]');
        avis.unshift({nom, message});
        localStorage.setItem('surela_avis', JSON.stringify(avis));
        afficherAvis();

        // Envoie sur Discord
        const payload = {
          content: `ðŸ“¢ **Nouvel avis client**\n**Nom**: ${nom}\n**Avis**: ${message}`
        };
        try {
          await fetch('https://discord.com/api/webhooks/1409116433807441950/KOJnDkPk6wC96-O5upYiHXQSyA4bPyVnOc_gDVpIkMOzGDkD4RAo7vZ1OXIsd6a0wdzs', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          document.getElementById('confirmation').textContent = "Merci pour votre avis !";
          this.reset();
        } catch (err) {
          document.getElementById('confirmation').textContent = "Erreur lors de l'envoi. RÃ©essayez plus tard.";
        }
      }
    }
    afficherAvis();
  </script>
</body>
</html>